{"version":3,"sources":["../src/main.js"],"names":["define","ajax","$","templates","processResults","selector","data","transport","query","success","failure","courseid","attr","call","methodname","args","search","searchanywhere","page","perpage","then","results","promises","identityfields","each","index","user","ctx","identity","i","k","hasidentity","push","join","render","html","value","id","label","when","apply","users","arguments","Array","prototype","slice","catch"],"mappings":"AAuBAA,OAAM,wBAAC,CAAC,WAAD,CAAc,QAAd,CAAwB,gBAAxB,CAAD,CAA4C,SAASC,CAAT,CAAeC,CAAf,CAAkBC,CAAlB,CAA6B,CAG3E,MAAkE,CAW9DC,cAAc,CAAE,wBAASC,CAAT,CAAmBC,CAAnB,CAAyB,CACrC,MAAOA,CAAAA,CACV,CAb6D,CAwB9DC,SAAS,CAAE,mBAASF,CAAT,CAAmBG,CAAnB,CAA0BC,CAA1B,CAAmCC,CAAnC,CAA4C,CACnD,GAAIC,CAAAA,CAAQ,CAAGT,CAAC,CAACG,CAAD,CAAD,CAAYO,IAAZ,CAAiB,eAAjB,CAAf,CAEAX,CAAI,CAACY,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,yBADL,CAEPC,IAAI,CAAE,CACFJ,QAAQ,CAAEA,CADR,CAEFK,MAAM,CAAER,CAFN,CAGFS,cAAc,GAHZ,CAIFC,IAAI,CAAE,CAJJ,CAKFC,OAAO,CAAE,EALP,CAFC,CAAD,CAAV,EASI,CATJ,EASOC,IATP,CASY,SAASC,CAAT,CAAkB,IACtBC,CAAAA,CAAQ,CAAG,EADW,CAEtBC,CAAc,CAAG,EAFK,CAK1BrB,CAAC,CAACsB,IAAF,CAAOH,CAAP,CAAgB,SAASI,CAAT,CAAgBC,CAAhB,CAAsB,CAClC,GAAIC,CAAAA,CAAG,CAAGD,CAAV,CACIE,CAAQ,CAAG,EADf,CAKI1B,CAAC,CAACsB,IAAF,CAAOD,CAAP,CAAuB,SAASM,CAAT,CAAYC,CAAZ,CAAe,CAClC,GAAuB,WAAnB,QAAOJ,CAAAA,CAAI,CAACI,CAAD,CAAX,EAA8C,EAAZ,GAAAJ,CAAI,CAACI,CAAD,CAA1C,CAAsD,CAClDH,CAAG,CAACI,WAAJ,IACAH,CAAQ,CAACI,IAAT,CAAcN,CAAI,CAACI,CAAD,CAAlB,CACH,CACJ,CALD,EAMAH,CAAG,CAACC,QAAJ,CAAeA,CAAQ,CAACK,IAAT,CAAc,IAAd,CAAf,CACAX,CAAQ,CAACU,IAAT,CAAc7B,CAAS,CAAC+B,MAAV,CAAiB,+CAAjB,CAAkEP,CAAlE,EAAuEP,IAAvE,CAA4E,SAASe,CAAT,CAAe,CACrG,MAAO,CAACC,KAAK,CAAEV,CAAI,CAACW,EAAb,CAAiBC,KAAK,CAAEH,CAAxB,CACV,CAFa,CAAd,CAIP,CAjBD,EAmBA,MAAOjC,CAAAA,CAAC,CAACqC,IAAF,CAAOC,KAAP,CAAatC,CAAb,CAAgBoB,CAAhB,CACV,CAlCD,EAkCGF,IAlCH,CAkCQ,UAAW,CACf,GAAIqB,CAAAA,CAAK,CAAG,EAAZ,CAGA,GAAIC,SAAS,CAAC,CAAD,CAAb,CAAkB,CAEdD,CAAK,CAAGE,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBhC,IAAtB,CAA2B6B,SAA3B,CACX,CAEDjC,CAAO,CAACgC,CAAD,CAEV,CA7CD,EA6CGK,KA7CH,CA6CSpC,CA7CT,CA8CH,CAzE6D,CA2ErE,CA9EK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to field.\n *\n * @subpackage share\n * @copyright  2022 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/ajax', 'jquery', 'core/templates'], function(ajax, $, templates) {\n\n\n    return /** @alias module:datafield_share/participants_selector */ {\n\n        // Public variables and functions.\n        /**\n         * Process the results returned from transport (convert to value + label)\n         *\n         * @method processResults\n         * @param {String} selector\n         * @param {Array} data\n         * @return {Array}\n         */\n        processResults: function(selector, data) {\n            return data;\n        },\n\n        /**\n         * Fetch results based on the current query. This also renders each result from a template before returning them.\n         *\n         * @method transport\n         * @param {String} selector Selector for the original select element\n         * @param {String} query Current search string\n         * @param {Function} success Success handler\n         * @param {Function} failure Failure handler\n         */\n        transport: function(selector, query, success, failure) {\n            var courseid = $(selector).attr('data-courseid');\n\n            ajax.call([{\n                methodname: 'core_enrol_search_users',\n                args: {\n                    courseid: courseid,\n                    search: query,\n                    searchanywhere: false,\n                    page: 0,\n                    perpage: 30\n                }\n            }])[0].then(function(results) {\n                var promises = [];\n                var identityfields = [];// ['email'];\n\n                // We got the results, now we loop over them and render each one from a template.\n                $.each(results, function(index, user) {\n                    var ctx = user,\n                        identity = [],\n                        show = true;\n\n                    if (show) {\n                        $.each(identityfields, function(i, k) {\n                            if (typeof user[k] !== 'undefined' && user[k] !== '') {\n                                ctx.hasidentity = true;\n                                identity.push(user[k]);\n                            }\n                        });\n                        ctx.identity = identity.join(', ');\n                        promises.push(templates.render('datafield_share/form-user-selector-suggestion', ctx).then(function(html) {\n                            return {value: user.id, label: html};\n                        }));\n                    }\n                });\n                // Do the dance for $.when()\n                return $.when.apply($, promises);\n            }).then(function() {\n                var users = [];\n\n                // Determine if we've been passed any arguments..\n                if (arguments[0]) {\n                    // Undo the $.when() dance from arguments object into an array..\n                    users = Array.prototype.slice.call(arguments);\n                }\n\n                success(users);\n                return;\n            }).catch(failure);\n        }\n    };\n});\n"],"file":"main.min.js"}